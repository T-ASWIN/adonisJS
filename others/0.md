
---


This project demonstrates:

HTTP method spoofing for DELETE/PATCH

Secure POST forms with CSRF

Watchlist toggle logic

Card UI component usage

Search, filter, sort, and pagination patterns



---

1️⃣ Method Spoofing Setup (app.ts)

allowMethodSpoofing: true

What it does

This allows AdonisJS to treat requests containing _method as real HTTP methods like:

DELETE

PATCH

PUT


Since HTML forms only support GET and POST, this option enables REST-style routes to work from views.


---

Example Form Using Query String

<form action="{{route('home.index'),{},{qs:{_method:'DELETE'}})}}" method="POST">

This adds:

?_method=DELETE

to the URL so Adonis routes it as a DELETE request.


---


---

2️⃣ Login Form with CSRF Protection

<form action="{{route('home.index'),{},{qs:{_method:'DELETE'} method='POST' }}}>

{{csrfField}}

<label name="email" >Email</label>
<input type="email" name="email" />

<label name="password" >Password</label>
<input type="password" name="password" />

<button type="submit" >Login</button>

</form>

Purpose

Uses POST for submitting credentials

Includes {{csrfField}} to protect against CSRF attacks

Demonstrates how spoofed methods and CSRF tokens coexist



---


---

3️⃣ Watchlist Toggle Controller Method

async toggle({request,prams,auth}:HttpContext){
const {movieId} =params
const user= auth.user!

const toggle= await Watchlist.query().related('user').where({movieId,userId}).first()

if(toggle){
await watchlist.delete()
else{
await watchlist.create({userId,movieId})
}

return response.redirectTo().back()

What it does

Reads the movie ID from route params

Gets the logged-in user

Checks if a watchlist entry already exists

Deletes it if found

Creates it if not found

Redirects back to the previous page


This implements a toggle pattern:
press once → add to watchlist
press again → remove from watchlist


---


---

4️⃣ Card Component for Toggle Button

Component Props

$props({
title:'',
poster:'',
toggleUrl:'',
inwatchlist:false,
})

These define the values the component expects.


---

Component Markup

<div>
<imgss src="{poster}" alt="{title}"/>
<h2>{{title}}</h2>

<form action="{toggleUrl}}" method="POST" >
{{csrfField}}
<button type="submit" >{{@if(inwatchlist)?'in watch list':'move to watch list'</button>
</form>

<div>

What it does

Displays movie poster & title

Sends POST request to toggle route

Shows different button text depending on inwatchlist



---


---

Component Usage

@!components.card()
@each(movie in movies)
title={movie.title}
poster={movie.poster}
toggleUrl={movie.url}
inwatchlist={movie.inwatch}
@endeach

Purpose

Loops over movies

Passes values into the card component

Keeps UI logic reusable and clean



---


---

5️⃣ Search, Status, Sort & Pagination Logic

Filters Object

const filters={
 search:request.input('search'),
 status:request.input('status'),
 sort:request.input('sort'),
}

Groups query params into one object.


---

Search Filter

moviefilter.whereILike('title',`%${filters.search}%`)

Performs partial, case-insensitive search.


---


---

Status Filter

moviefilter.where('statusId',filters.status)

Filters by movie status.


---


---

Sorting Map

const sortMap ={
'title_asc':['title','asc'],
'title-desc':column='title',filter='desc'
}

Maps UI sort values to database column + direction.


---


---

Pagination

const page = request.input('page',1)

Reads the current page from the query string.


---

moviefilter.baseUrl(makeUrl('movies.index'))

Ensures pagination links use the correct route.


---


